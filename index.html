<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–°–æ—Ä—Ç—É–≤–∞–ª—å–Ω–∏–∫ —Å–ª—ñ–≤</title>
  <style>
    :root{
      --bg:#f4f5f7;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --blue:#0a5fa5;
      --blue2:#084c86;
      --good:#16a34a;
      --bad:#ef4444;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --radius:14px;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{margin:0;background:var(--bg);color:var(--text)}
    .topbar{
      height:46px;background:#2f2f2f;color:#fff;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 14px;font-size:14px
    }
    .topbar .left, .topbar .right{display:flex;gap:16px;align-items:center}
    .badge{display:inline-flex;align-items:center;gap:8px;opacity:.95}
    .flag{width:10px;height:10px;border-radius:2px;background:#fff;display:inline-block;opacity:.8}
    .content{max-width:900px;margin:0 auto;padding:16px}
    h1,h2,h3{margin:0 0 10px}
    .sub{color:var(--muted);margin:0 0 16px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
    }
    .center{display:flex;flex-direction:column;align-items:center;gap:14px}
    .titleline{
      width:100%;
      border-top:4px solid var(--blue);
      margin:10px 0 0;
    }
    .prompt{
      font-size:20px;font-weight:700;text-align:center;margin-top:6px
    }

    .form{
      width:min(520px, 100%);
      display:grid;gap:12px;margin-top:10px
    }
    label{font-size:13px;color:var(--muted)}
    input{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      outline:none;
      font-size:15px;
      background:#fff;
    }
    input:focus{border-color:#b7d4ef; box-shadow:0 0 0 4px rgba(10,95,165,.12)}
    .btn{
      border:none;cursor:pointer;
      padding:12px 16px;border-radius:12px;
      background:var(--blue);color:#fff;font-weight:700;
      font-size:14px;letter-spacing:.2px;
      transition:transform .03s ease, background .15s ease;
      display:inline-flex;align-items:center;justify-content:center;
      min-width:160px;
    }
    .btn:hover{background:var(--blue2)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{
      background:#111827;
    }
    .btn.secondary:hover{background:#0b1220}
    .row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    .pill{
      font-size:13px;color:#0b1220;background:#eef6ff;border:1px solid #d7e9ff;
      padding:8px 10px;border-radius:999px
    }

    .listWrap{width:min(520px, 100%); margin-top:6px}
    .list{
      list-style:none;padding:0;margin:0;
      border:1px solid var(--line);
      border-radius:12px; overflow:hidden;
      background:#fff;
    }
    .item{
      padding:12px 14px;
      border-top:1px solid var(--line);
      display:flex;align-items:center;justify-content:center;
      font-weight:700;
      user-select:none;
      touch-action:none;
      position:relative;
      background:#fff;
    }
    .item:first-child{border-top:none}
    .item[aria-grabbed="true"]{
      box-shadow:0 10px 22px rgba(0,0,0,.14);
      border:1px solid #cfe6ff;
      z-index:50;
    }
    .hint{font-size:13px;color:var(--muted);text-align:center;margin-top:6px}

    .countdown{
      font-size:46px;font-weight:900;line-height:1;
      margin:6px 0 0;
    }
    .status{
      margin-top:10px;
      font-size:14px;
      font-weight:700;
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--line);
      background:#fafafa;
      width:min(520px, 100%);
      text-align:center;
    }
    .status.good{border-color:#bbf7d0;background:#f0fdf4;color:#14532d}
    .status.bad{border-color:#fecaca;background:#fef2f2;color:#7f1d1d}

    .small{font-size:12px;color:var(--muted)}
    .divider{height:1px;background:var(--line);width:100%;margin:8px 0}
    .summary{
      width:min(620px,100%);
      display:grid;gap:8px;
    }
    .kv{
      display:flex;justify-content:space-between;gap:12px;
      padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff
    }
    .kv b{font-weight:800}
    .footerNote{color:var(--muted);font-size:12px;text-align:center;margin-top:6px}

    /* placeholder spacing similar to video */
    .spacer{height:6px}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="left">
      <div class="badge">‚úì <span id="scoreTop">–ë–∞–ª–∏: 0</span></div>
    </div>
    <div class="right">
      <div class="badge"><span class="flag"></span><span id="lvlTop">–†—ñ–≤–µ–Ω—å: 0 / 5</span></div>
    </div>
  </div>

  <div class="content">
    <div class="card">
      <div style="font-weight:800;font-size:18px">–í—ñ–¥—Å–æ—Ä—Ç—É–π—Ç–µ —Å–ª–æ–≤–∞</div>
      <div class="titleline"></div>

      <!-- SCREENS -->
      <div id="screenStart" class="center" style="margin-top:14px">
        <div class="prompt">–í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ –¥–ª—è —Å—Ç–∞—Ä—Ç—É</div>
        <p class="sub">–ü—ñ—Å–ª—è –ø–æ—á–∞—Ç–∫—É –±—É–¥–µ 5 —Ä—ñ–≤–Ω—ñ–≤: 3 ‚Üí 7 —Å–ª—ñ–≤. –ß–∞—Å –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –Ω–µ –æ–±–º–µ–∂–µ–Ω–∏–π.</p>

        <div class="form">
          <div>
            <label for="name">–Ü–º‚Äô—è</label>
            <input id="name" type="text" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ê–Ω–∞—Å—Ç–∞—Å—ñ—è" autocomplete="name" />
          </div>
          <div>
            <label for="email">–ü–æ—à—Ç–∞</label>
            <input id="email" type="email" placeholder="name@example.com" autocomplete="email" />
          </div>
          <button id="btnStart" class="btn">–ü–æ—á–∞—Ç–∏ –≥—Ä—É</button>
          <div class="small">–ù—ñ—á–æ–≥–æ –∑–∞–π–≤–æ–≥–æ ‚Äî —Ç—ñ–ª—å–∫–∏ —Å—Ç–∞—Ä—Ç.</div>
        </div>
      </div>

      <div id="screenGame" class="center" style="display:none; margin-top:14px">
        <div class="prompt" id="phaseTitle">–ó–∞–ø–∞–º‚Äô—è—Ç–∞–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Å–ª—ñ–≤</div>

        <div class="row">
          <div class="pill" id="pillLevel">–†—ñ–≤–µ–Ω—å 1 / 5</div>
          <div class="pill" id="pillWords">–°–ª—ñ–≤: 3</div>
        </div>

        <div id="countdownBox" class="center" style="gap:6px">
          <div class="countdown" id="countdown">8</div>
          <div class="small">–°–ª–æ–≤–∞ –∑–Ω–∏–∫–Ω—É—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</div>
        </div>

        <div class="listWrap">
          <ul id="wordList" class="list" aria-label="–°–ø–∏—Å–æ–∫ —Å–ª—ñ–≤"></ul>
          <div class="hint" id="hint">–ü—ñ–¥ —á–∞—Å –∑–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–µ.</div>
        </div>

        <div class="row" style="margin-top:10px">
          <button id="btnCheck" class="btn" style="display:none">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
        </div>

        <div id="status" class="status" style="display:none"></div>
      </div>

      <div id="screenEnd" class="center" style="display:none; margin-top:14px">
        <div class="prompt">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
        <p class="sub" id="endSub">–ì–æ—Ç–æ–≤–æ!</p>

        <div class="summary" id="summary"></div>

        <div class="row" style="margin-top:8px">
          <button id="btnRestart" class="btn secondary">–ü–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
        </div>

        <div class="footerNote">–î—è–∫—É—î–º–æ –∑–∞ –≥—Ä—É üíôüíõ</div>
      </div>
    </div>
  </div>

<script>
/* =======================
   –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø TELEGRAM
   ======================= */
const BOT_TOKEN = "8517397402:AAERo7gAWPoCyCKpx9_T6b4tZRQazAZrX1k";
const CHAT_ID   = "1350269784";

/* =======================
   –õ–û–ì–Ü–ö–ê –ì–†–ò
   ======================= */
const LEVEL_SIZES = [3,4,5,6,7];
const MEM_SECONDS = 8; // —á–∞—Å –Ω–∞ –∑–∞–ø–∞–º'—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)

// –ü—É–ª —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö —Å–ª—ñ–≤ (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä—ñ–≤ —É —Ä—ñ–≤–Ω—ñ)
const WORD_POOL = [
  "–∫–∞–ª–∏–Ω–∞","—Å–≤—ñ—Ç–ª–æ","–≤–µ—Å–Ω–∞","–º—Ä—ñ—è","–≤—ñ—Ç—Ä–∏–ª–∞","–¥–∑–≤—ñ–Ω","–Ω–µ–±–æ","—Ä—ñ–∫–∞","–ª—ñ—Å","—Ö–≤–∏–ª—è",
  "–∑—ñ—Ä–∫–∞","–ø—ñ—Å–Ω—è","–∫—Ä–∏–ª–∞","–ø–∞–º‚Äô—è—Ç—å","–∂–æ–≤—Ç–µ–Ω—å","—Å–æ–Ω—è—Ö","–≤–∏—à–Ω—è","—Å—Ç–µ–∂–∫–∞","—Ç–µ–ø–ª–æ","—Å–º—ñ—Ö",
  "–¥—Ä—É–∂–±–∞","—Å–∏–ª–∞","–Ω–∞–¥—ñ—è","–≤–æ–≥–Ω–∏–∫","—Å–µ—Ä—Ü–µ","–∫–∞–º—ñ–Ω—å","—Ä–∞–Ω–æ–∫","–≤–µ—á—ñ—Ä","–∫–≤—ñ—Ç–∫–∞","–∫—Ä–∏–Ω–∏—Ü—è",
  "–≤—ñ–∫–Ω–æ","–¥–æ—Ä–æ–≥–∞","—Å—Ç—Ä—É–º–æ–∫","–ø–∏—Ä—ñ–≥","—à–∫–æ–ª–∞","–∫–Ω–∏–≥–∞","–æ–ª—ñ–≤–µ—Ü—å","–º—ñ—Å—Ç–æ","—Å–∞–¥–æ–∫","–ø–ª–æ—â–∞",
  "–±–µ—Ä–µ–≥","–≤–∏—à–∏–≤–∞–Ω–∫–∞","–∫–æ–±–∑–∞—Ä","–º–∞–Ω–¥—Ä—ñ–≤–∫–∞","–≤–µ—Å–µ–ª–∫–∞","—Ç–∏—à–∞","–ø–æ–≥–ª—è–¥","–ø—É–ª—å—Å","—Ç—Ä–∏–≤–æ–≥–∞","—Å–ø–æ–∫—ñ–π",
  "–ø–ª–∞–Ω–µ—Ç–∞","–≤—á–∏—Ç–µ–ª—å","—É—á–µ–Ω—å","–∫–æ–º–∞–Ω–¥–∞","—É—Å–ø—ñ—Ö","–ø—ñ–¥–∫–∞–∑–∫–∞","–µ–∫—Ä–∞–Ω","–∫–Ω–æ–ø–∫–∞","—Ä—è–¥–æ–∫","–ø–∞–∑–ª"
];

// DOM
const el = (id)=>document.getElementById(id);

const screenStart = el("screenStart");
const screenGame  = el("screenGame");
const screenEnd   = el("screenEnd");

const scoreTop = el("scoreTop");
const lvlTop   = el("lvlTop");

const phaseTitle = el("phaseTitle");
const pillLevel  = el("pillLevel");
const pillWords  = el("pillWords");

const countdownBox = el("countdownBox");
const countdownEl  = el("countdown");
const wordListEl   = el("wordList");
const hintEl       = el("hint");
const btnCheck     = el("btnCheck");
const statusEl     = el("status");

const nameEl  = el("name");
const emailEl = el("email");
const btnStart = el("btnStart");

const summaryEl = el("summary");
const endSubEl  = el("endSub");
const btnRestart = el("btnRestart");

// State
let player = { name:"", email:"" };
let startTimeMs = 0;

let levelIndex = 0;
let score = 0;

let correctOrder = [];
let currentOrder = [];
let perLevel = []; // {level, size, correctPositions, scoreAdd}

let countdownTimer = null;
let countdownLeft = MEM_SECONDS;

function nowMs(){ return Date.now(); }

function formatTime(ms){
  const s = Math.floor(ms/1000);
  const hh = Math.floor(s/3600);
  const mm = Math.floor((s%3600)/60);
  const ss = s%60;
  const pad = (n)=>String(n).padStart(2,"0");
  return (hh>0 ? `${hh}:${pad(mm)}:${pad(ss)}` : `${mm}:${pad(ss)}`);
}

function setTop(){
  scoreTop.textContent = `–ë–∞–ª–∏: ${score}`;
  lvlTop.textContent = `–†—ñ–≤–µ–Ω—å: ${Math.min(levelIndex+1,5)} / 5`;
}

function showScreen(which){
  screenStart.style.display = which==="start" ? "flex" : "none";
  screenGame.style.display  = which==="game"  ? "flex" : "none";
  screenEnd.style.display   = which==="end"   ? "flex" : "none";
}

function pickWords(count, avoidSet){
  // avoidSet: Set —Å–ª—ñ–≤, —è–∫—ñ –≤–∂–µ –±—Ä–∞–ª–∏ (—â–æ–± –ø–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –Ω–µ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –º—ñ–∂ —Ä—ñ–≤–Ω—è–º–∏)
  const pool = WORD_POOL.filter(w => !avoidSet.has(w));
  const src = (pool.length >= count) ? pool : WORD_POOL.slice(); // —è–∫—â–æ –Ω–µ –≤–∏—Å—Ç–∞—á–∞—î ‚Äî –¥–æ–∑–≤–æ–ª—è—î–º–æ –ø–æ–≤—Ç–æ—Ä–∏
  // shuffle
  for(let i=src.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [src[i],src[j]]=[src[j],src[i]];
  }
  return src.slice(0,count);
}

function renderList(words){
  wordListEl.innerHTML = "";
  for(const w of words){
    const li = document.createElement("li");
    li.className = "item";
    li.textContent = w.toUpperCase();
    wordListEl.appendChild(li);
  }
}

/* =======================
   SORTABLE (DESKTOP+MOBILE)
   Pointer-based reorder
   ======================= */
let drag = {
  active:false,
  item:null,
  startY:0,
  currentY:0,
  offsetY:0,
  placeholder:null,
  listRect:null
};

function getItems(){
  return Array.from(wordListEl.querySelectorAll(".item"));
}

function enableDrag(enable){
  for(const it of getItems()){
    it.style.pointerEvents = enable ? "auto" : "none";
  }
}

function indexOfNode(node){
  return Array.from(wordListEl.children).indexOf(node);
}

function createPlaceholder(height){
  const ph = document.createElement("li");
  ph.className = "item";
  ph.style.opacity = "0";
  ph.style.height = height + "px";
  ph.style.borderTop = "1px solid var(--line)";
  ph.textContent = " ";
  return ph;
}

function onPointerDown(e){
  const target = e.target.closest(".item");
  if(!target || btnCheck.style.display==="none") return; // drag only in sorting phase
  e.preventDefault();

  drag.active = true;
  drag.item = target;
  drag.listRect = wordListEl.getBoundingClientRect();
  const r = target.getBoundingClientRect();

  drag.startY = e.clientY;
  drag.offsetY = e.clientY - r.top;

  target.setAttribute("aria-grabbed","true");
  target.style.width = r.width + "px";
  target.style.position = "fixed";
  target.style.left = r.left + "px";
  target.style.top = r.top + "px";

  drag.placeholder = createPlaceholder(r.height);
  wordListEl.insertBefore(drag.placeholder, target.nextSibling);

  // move item out of flow
  wordListEl.removeChild(target);
  document.body.appendChild(target);

  document.addEventListener("pointermove", onPointerMove, {passive:false});
  document.addEventListener("pointerup", onPointerUp, {passive:false, once:true});
}

function onPointerMove(e){
  if(!drag.active) return;
  e.preventDefault();

  const y = e.clientY - drag.offsetY;
  drag.item.style.top = y + "px";

  // decide placeholder position
  const items = Array.from(wordListEl.querySelectorAll(".item"));
  const ph = drag.placeholder;

  // if list is empty, just append placeholder
  if(items.length===0){
    wordListEl.appendChild(ph);
    return;
  }

  // find closest insertion point by y center
  let insertBefore = null;
  for(const it of items){
    if(it === ph) continue;
    const rect = it.getBoundingClientRect();
    const mid = rect.top + rect.height/2;
    if(e.clientY < mid){
      insertBefore = it;
      break;
    }
  }
  if(insertBefore){
    if(ph !== insertBefore.previousSibling){
      wordListEl.insertBefore(ph, insertBefore);
    }
  }else{
    wordListEl.appendChild(ph);
  }
}

function onPointerUp(e){
  document.removeEventListener("pointermove", onPointerMove);
  if(!drag.active) return;

  drag.active = false;

  const ph = drag.placeholder;
  const item = drag.item;

  // put item back into list at placeholder
  item.style.position = "relative";
  item.style.left = "0px";
  item.style.top = "0px";
  item.style.width = "auto";
  item.removeAttribute("aria-grabbed");

  document.body.removeChild(item);
  wordListEl.insertBefore(item, ph);
  wordListEl.removeChild(ph);

  drag.item = null;
  drag.placeholder = null;
  drag.listRect = null;
}

wordListEl.addEventListener("pointerdown", onPointerDown, {passive:false});

/* =======================
   PHASES
   ======================= */
function startLevel(){
  setTop();

  const size = LEVEL_SIZES[levelIndex];
  pillLevel.textContent = `–†—ñ–≤–µ–Ω—å ${levelIndex+1} / 5`;
  pillWords.textContent = `–°–ª—ñ–≤: ${size}`;

  statusEl.style.display = "none";
  statusEl.className = "status";
  btnCheck.style.display = "none";

  phaseTitle.textContent = "–ó–∞–ø–∞–º‚Äô—è—Ç–∞–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Å–ª—ñ–≤";
  hintEl.textContent = "–ü—ñ–¥ —á–∞—Å –∑–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–µ.";

  countdownBox.style.display = "flex";
  countdownLeft = MEM_SECONDS;
  countdownEl.textContent = countdownLeft;

  // choose words
  const used = new Set(perLevel.flatMap(x => x.words || []));
  correctOrder = pickWords(size, used);
  currentOrder = correctOrder.slice();

  // show correct order for memorization
  renderList(correctOrder);
  enableDrag(false);

  // run countdown
  clearInterval(countdownTimer);
  countdownTimer = setInterval(()=>{
    countdownLeft--;
    countdownEl.textContent = countdownLeft;
    if(countdownLeft<=0){
      clearInterval(countdownTimer);
      beginSortingPhase();
    }
  }, 1000);
}

function shuffleArray(a){
  const arr = a.slice();
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function beginSortingPhase(){
  phaseTitle.textContent = "–í—ñ–¥–Ω–æ–≤—ñ—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–ª—ñ–≤";
  hintEl.textContent = "–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Å–ª–æ–≤–∞, —â–æ–± –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø–æ—Ä—è–¥–æ–∫, —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏¬ª.";

  // shuffle, but avoid same order
  let shuffled = shuffleArray(correctOrder);
  let guard = 0;
  while(shuffled.join("|") === correctOrder.join("|") && guard<8){
    shuffled = shuffleArray(correctOrder);
    guard++;
  }

  renderList(shuffled);
  enableDrag(true);

  countdownBox.style.display = "none";
  btnCheck.style.display = "inline-flex";
}

function getCurrentWordsFromUI(){
  return Array.from(wordListEl.children).map(li => li.textContent.toLowerCase());
}

function computeScoreForLevel(order){
  // +5 –±–∞–ª—ñ–≤ –∑–∞ –∫–æ–∂–Ω—É –ø–æ–∑–∏—Ü—ñ—é, —â–æ —Å–ø—ñ–≤–ø–∞–ª–∞
  let correct = 0;
  for(let i=0;i<correctOrder.length;i++){
    if(order[i] === correctOrder[i]) correct++;
  }
  return { correctPositions: correct, scoreAdd: correct*5 };
}

function checkLevel(){
  const order = getCurrentWordsFromUI();
  const {correctPositions, scoreAdd} = computeScoreForLevel(order);

  score += scoreAdd;
  setTop();

  const size = correctOrder.length;

  // status
  statusEl.style.display = "block";
  if(correctPositions === size){
    statusEl.className = "status good";
    statusEl.textContent = `‚úÖ –ß—É–¥–æ–≤–æ! –£—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ. +${scoreAdd} –±–∞–ª—ñ–≤`;
  }else if(correctPositions === 0){
    statusEl.className = "status bad";
    statusEl.textContent = `‚ùå –ù–µ —Å–ø—ñ–≤–ø–∞–ª–∞ –∂–æ–¥–Ω–∞ –ø–æ–∑–∏—Ü—ñ—è. +0 –±–∞–ª—ñ–≤`;
  }else{
    statusEl.className = "status";
    statusEl.textContent = `‚ÑπÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø–æ–∑–∏—Ü—ñ–π: ${correctPositions} –∑ ${size}. +${scoreAdd} –±–∞–ª—ñ–≤`;
  }

  perLevel.push({
    level: levelIndex+1,
    size,
    correctPositions,
    scoreAdd,
    words: correctOrder.slice()
  });

  btnCheck.style.display = "none";
  enableDrag(false);

  // next after short pause
  setTimeout(()=>{
    levelIndex++;
    if(levelIndex < LEVEL_SIZES.length){
      startLevel();
    }else{
      finishGame();
    }
  }, 900);
}

/* =======================
   END + TELEGRAM
   ======================= */
function buildSummary(){
  summaryEl.innerHTML = "";
  const totalMs = nowMs() - startTimeMs;
  const totalWords = perLevel.reduce((s,x)=>s+x.size,0);
  const totalCorrectPositions = perLevel.reduce((s,x)=>s+x.correctPositions,0);
  const accuracy = totalWords ? Math.round((totalCorrectPositions/totalWords)*100) : 0;

  const rows = [
    ["–Ü–º‚Äô—è", player.name],
    ["–ü–æ—à—Ç–∞", player.email],
    ["–ü—ñ–¥—Å—É–º–∫–æ–≤—ñ –±–∞–ª–∏", String(score)],
    ["–¢–æ—á–Ω—ñ—Å—Ç—å (–ø–æ–∑–∏—Ü—ñ—ó)", `${accuracy}% (${totalCorrectPositions}/${totalWords})`],
    ["–ß–∞—Å –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è", formatTime(totalMs)]
  ];

  for(const [k,v] of rows){
    const div = document.createElement("div");
    div.className = "kv";
    div.innerHTML = `<span>${k}</span><b>${escapeHtml(v)}</b>`;
    summaryEl.appendChild(div);
  }

  // per-level breakdown
  const d = document.createElement("div");
  d.className = "divider";
  summaryEl.appendChild(d);

  for(const x of perLevel){
    const div = document.createElement("div");
    div.className = "kv";
    div.innerHTML = `<span>–†—ñ–≤–µ–Ω—å ${x.level} (—Å–ª—ñ–≤: ${x.size})</span><b>${x.correctPositions}/${x.size} ‚Ä¢ +${x.scoreAdd}</b>`;
    summaryEl.appendChild(div);
  }

  endSubEl.textContent = "–ì–æ—Ç–æ–≤–æ! –ù–∏–∂—á–µ ‚Äî –≤–∞—à –ø—ñ–¥—Å—É–º–æ–∫.";
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

function sendToTelegram(){
  // –£ –±—Ä–∞—É–∑–µ—Ä—ñ Telegram API —á–∞—Å—Ç–æ –±–µ–∑ CORS. –¢–æ–º—É —à–ª–µ–º–æ —è–∫ no-cors (–∑–∞–ø–∏—Ç –ø—ñ–¥–µ, –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ —á–∏—Ç–∞—î–º–æ).
  const totalMs = nowMs() - startTimeMs;
  const totalWords = perLevel.reduce((s,x)=>s+x.size,0);
  const totalCorrectPositions = perLevel.reduce((s,x)=>s+x.correctPositions,0);
  const accuracy = totalWords ? Math.round((totalCorrectPositions/totalWords)*100) : 0;

  const details = perLevel.map(x => `–†${x.level}: ${x.correctPositions}/${x.size} (+${x.scoreAdd})`).join(" | ");

  const msg =
`üß† –°–æ—Ä—Ç—É–≤–∞–ª—å–Ω–∏–∫ —Å–ª—ñ–≤ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç
üë§ –Ü–º‚Äô—è: ${player.name}
üìß –ü–æ—à—Ç–∞: ${player.email}
‚≠ê –ë–∞–ª–∏: ${score}
üéØ –¢–æ—á–Ω—ñ—Å—Ç—å: ${accuracy}% (${totalCorrectPositions}/${totalWords})
‚è± –ß–∞—Å: ${formatTime(totalMs)}
üìã ${details}`;

  const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${encodeURIComponent(CHAT_ID)}&text=${encodeURIComponent(msg)}`;

  try{
    fetch(url, { method:"GET", mode:"no-cors" }).catch(()=>{});
  }catch(e){
    // fallback: create img request
    const img = new Image();
    img.src = url;
  }
}

function finishGame(){
  showScreen("end");
  buildSummary();
  sendToTelegram();
}

/* =======================
   START/RESTART
   ======================= */
btnStart.addEventListener("click", ()=>{
  const name = nameEl.value.trim();
  const email = emailEl.value.trim();

  if(!name){
    nameEl.focus();
    return;
  }
  if(!email || !/^\S+@\S+\.\S+$/.test(email)){
    emailEl.focus();
    return;
  }

  player.name = name;
  player.email = email;

  // reset state
  levelIndex = 0;
  score = 0;
  perLevel = [];
  startTimeMs = nowMs();

  setTop();
  showScreen("game");
  startLevel();
});

btnCheck.addEventListener("click", checkLevel);

btnRestart.addEventListener("click", ()=>{
  // reset UI to start (–±–µ–∑ –∑–∞–π–≤–æ–≥–æ)
  clearInterval(countdownTimer);
  nameEl.value = player.name || "";
  emailEl.value = player.email || "";
  score = 0;
  levelIndex = 0;
  perLevel = [];
  setTop();
  showScreen("start");
});

// initial top
setTop();
</script>
</body>
</html>
